<!DOCTYPE html>
<meta charset="utf-8">

<style>



    path {
        stroke: #fff;
        stroke-width: 1px;
    }

    path:hover {
        fill: #16a78d;

    }
    .background {
        fill: #eee;
        pointer-events: all;
    }

</style>

<body>


<script src="//d3js.org/d3.v4.js"></script>
<script src="//d3js.org/topojson.v1.js"></script>


<script>
    //<link rel="stylesheet" href="/styles/viz_styles.css">
    var margin = {top: 20, left: 20, right: 20, bottom: 20};


    var width = window.innerWidth - margin.left-margin.right,
        height = window.innerHeight - margin.top - margin.bottom;

    var svg = d3.select("body").append("svg")
        .attr("width", width+50)
        .attr("height", height+200);


    var data ='https://gist.githubusercontent.com/ostapkharysh/3dab6a416ad365e0ca50d53730ccf2c3/raw/cad9cd18d6c5e62d5aab9b69c3be72e13c4b6251/ukr_map.json';


    var color = d3.scaleLinear()
        .domain([1, 20])
        .clamp(true)
        .range(['#fff', '#409A99']);


    // function Click(d) {
    //     delete d.d;
    //     console.log(d)
    // }




    d3.json(data, function(topology) {
        var geojson = topojson.feature(topology, topology.objects.gadm36_UKR_1);

        var center = d3.geoCentroid(geojson);
        var scale = 2300;
        var offset = [width / 3.2, height / 2];

        var projection = d3.geoMercator().scale(scale).center(center).translate(offset);

        color.domain([0, d3.max(geojson.features, nameLength)]); // Update color scale domain based on
        // length of the names

        console.log("center", center);
        console.log("geojson features", geojson.features);

        svg.append('rect')
            .attr('class', 'background')
            .attr('width', width)
            .attr('height', height+50);
        //.on('click', clicked);

        var group = svg.selectAll("g")
            .data(geojson.features)
            .enter().append("g");


        group
            .append("tspan")
            .text ( ({properties}) => properties.NAME_1)

        var path = d3.geoPath().projection(projection);


        var areas = group.append("path")
            .attr("d", path).
            style('fill', fillFn)
            //.on("mousemove", mouseOver).on("mouseout", mouseOut).on("click", Click)
            .attr("transform", function(d) { console.log("d", d.properties.NAME_1)});
            //.text(function(d) { return d.properties.NAME_1; })



    });

    // Get region name
    function nameFn(d){
        //console.log("PROPERTIES",d.properties);
        return d.properties ? d.properties.NAME_1 : null;
    }

    // Get region color
    function fillFn(d){
        return color(nameLength(d));
    }

    function nameLength(d){
        var n = nameFn(d);
        return n ? n.length : 0;
    }




</script>
